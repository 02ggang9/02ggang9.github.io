---
published: true
title:  "Wargame - Challenge60 - Race Condition 풀이"
categories:
  - wargame
---
## 문제

Race Condition 실습 문제입니다! 이 문제는 버그 바운티 프로그램에 참여했을 때 다른 분들의 보고서를 읽고 궁금해서 Race Condition 개념을 정리하고 [Webhacking.kr](http://Webhacking.kr) 사이트에 문제가 있다고 해서 풀어봤습니다!!

![쿼리횟수](https://github.com/02ggang9/02ggang9.github.io/blob/master/_posts/images/wargame/challenge60/1.png?raw=true)

## 풀이

Race Condition의 개념은 → [버그 바운티 | Race Condition](https://www.notion.so/Race-Condition-19d8b327a83448a5a34d325102a2f5b6?pvs=21) 에서 확인!

Race Condition의 냄새가 솔솔 나는게 Sleep(1)을 준다는 것과 임시 파일을 만들고 삭제하는 과정이 있기 때문입니다. 핵심 코드만을 분석해보면 아래와 같습니다.

mode 파라미터의 값이 auth일 때 SESSION[”idx”].txt 파일을 열고 파일 값을 읽어 옵니다. 그리고 가져온 값과 IDX 값이 같으면 문제가 풀립니다. 하지만 mode 파라미터의 값이 없을 때는 SESSION[”idx”].txt 파일을 열고 현재 IDX 값을 쓰고 닫습니다. 그리고 SLEEP(1)을 수행하고 해당 파일을 삭제합니다.

위의 분석을 통해서 프로세스를 알아보면 아래와 같습니다.

 

- mode == “auth” 일 때

SESSION[”idx”].txt 파일 열고 값을 저장 → 값을 비교 → 값이 똑같다면 문제 풀이 완료!

- mode == “null” 일 때 (파라미터 값이 없을 때)

SESSION[”idx”].txt 파일을 쓰기 모드로 열기 → 현재 값을 파일에 쓰기 → SLEEP(1) → 값을 쓴 파일 삭제

문제를 처음 풀면 SESSION[”idx”].txt 파일에 아무런 값이 없을 것입니다. 그래서 값을 비교했을 때 통과가 되려면 쓰기 과정을 먼저 진행 해줘야 합니다. 그래서 mode == NULL 으로 페이지에 접근하면 파일에 글을 쓰고 SLEEP(1)을 할 것입니다. SLEEP(1)이 진행 중일 때 mode == “auth”로 페이지에 접근한다면 글을 쓴 값을 비교하고 문제 풀이를 완료 해줄 것입니다.

```python
import requests

def http_get(authMode):
    URL = "https://webhacking.kr/challenge/web-37/"

    header_1 = {        
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.5481.78 Safari/537.36",
        "Cookie": "PHPSESSID=11"
    }

    cookie_1 = {
        "Cookie": "PHPSESSID=11"
    }

    data_1 = {
        
    }

    req = requests.get(url=URL, params=data_1, headers=header_1, cookies=cookie_1)
    print(req.text)

for i in range(100):
    http_get(True)
```

위의 파이썬 코드를 이용하면 계속 request를 보냅니다. SLEEP(1) 타이밍에 맞춰서 mode 파라미터와 함께 페이지에 접근한다면 문제가 풀릴 것입니다!

(단, 지금 헤더가 크롬으로 되어있기 때문에 크롬을 제외한 다른 브라우저와 세션 아이디를 가지고 접근 해야합니다! 저는 웨일로 접근했습니다.)
