---
published: false
title:  "Spring Security - 웹 애플리케이션 이해"
categories:
  - spring
---

## 웹 서버, 웹 애플리케이션 서버

HTTP로 거의 모든 형태의 데이터를 전송할 수 있음
HTML, Text, 음성, 이미지도 된다. 형태는 JSON 형태일 수도 있고, XML 형식일 수도 있겠지용.

웹서버 대표적으로 엔진x, 아파치가 있네용
얘네들은 동적인 리소스 제공을 못함. 그래서 그냥 HTML, json 형태의 간단한 리소스만 제공할 수 있음.

웹어플리케이션서버(WAS)는 대표적으로 톰캣이 있겠네용. 스프링 부트는 임베디드 톰캣을 가지고 있음.
얘네들은 정적인 리소스도 제공할 수 있고, 동적인 리소스도 제공할 수 있음. 어플리케이션 로직 가능

자바에서는 서블릿 컨테이너 기능을 제공하면 WAS라고 봐도됨.

클라이언트 -> WAS -> DB를 두면 좀 에바임. 왜냐하면 WAS는 정적 + 동적 + 애플리케이션 로직을 돌릴 수 있어서 클라이언트에서 WAS로 바로 넘어가면 부하가 넘 많음. 
그래서 앞단에 Web SERVER를 둠. 얘내들은 정적인 리로스만 제공을 할 수 있기 떄문에 WAS의 역할을 좀 덜어줄 수 있음. 그래서 클라이언트 -> 웹 서버 -> 와스 -> 디비 거의 이렇게 둠.
이렇게 두면 정적인 리로스 제공을 좀 많이 한다싶으면 WS만 증설하면 됨. 반대로 동적인 리소스를 더 많이 제공한다면 WS는 그대로 두고 WAS만 증설하면 됨. (근데 현실은 더 복잡함.)
이렇게 하면 장점이 WAS의 역할을 줄여줘서 덜 죽게 만들 수 있음. 그리고 WAS가 죽어도 오류 페이지를 제공할 수 있음. 에러 페이지 제공 안하면 좀 이상함;
요즘에는 앞단에서도 CDN을 둬서 HTML 캐싱을 한다고 하는데 뭔 말인지 잘 모르곘음. 찾아봐야 할듯.

## 서블릿
서블릿은 클라이언트의 요청과 결과를 반활할 수 있도록 도와주는 기술임. 어떻게 도와주냐
우리가 폼 형식으로 데이터를 전송하면 개발자는 뭘 해야함? http 메시지를 슬라이스치고 데이터를 읽어와야함. 예를 들면 md -> pdf로 변환할 때 "###"가 몇 번 쓰였는지 확인해야 하는 것처럼 
근데 서블릿은 이걸 알아서 다 잘라줌. 개발자들이 해야 할것은 extends HttpServlet을 상속받아서 메서드를 구현하면 됨. 근데 메서드 구현할 때 파라미터로 두 개를 받는데 HttpSerlvetRequest고, HttpServletResponse임. 애네들을 사용해서 쉽게 메시지를 가져오고 쉽게 결과 값을 반환할 수 있음.

클라이언트에서 request가 들어오면 서블릿 객체를 새로 만듬. (정확히 말하면 새로 만드는게 아니라 재사용함. 얘네 둘은 서블릿 컨테이너가 뜰 때 싱글톤으로 만들어짐. 계속 재사용하는거임.) 서블릿 컨테이너가 내려가면 서블릿 객체는 사라짐. 생명주기도 관리해준다 ㅇㅇ;
근데 사용자 요청이 들어오면 reqeust랑 response를 새로 만들어줘야힘. 왜냐하면 내가 로그인 했는데 다른 사람 계정이 보이면 안됨.
공유변수 사용 조심해야 하고 얘네들은 동시 요청을 위한 멀티 스레드 처리도 지원한다고 함. 이건 다음 강의 때 배우자.


## 쓰레드
우리의 코드는 스레드가 실행시킴. 자바 코드를 작성할 때 main 스레드를 실행시켜 봤겠지요. main 쓰레드 하나만 동작하면 1초에 1000명~1만명이 들어오는 reqeust를 처리할 수 없음. 만약 main 스레드 하나만 동작하면 클라이언트 한명만 request를 보내고 response를 받을 수 있음. 이렇게 되면 안됨. 다른 클라이언트는 스레드를 기다려야 함. 근데 만약에 벌크 쿼리 잘못 날려서 스레드가 지연되면 그냥 WAS가 죽어버림.

두 번째 방법으로 요청마다 쓰레드를 생성해버리면 과부하로 WAS가 죽음. CPU, 메모리 임계점 넘어가버리면 WAS 죽음.

절충안으로 WAS는 스레드 풀에 여러개의 스레드를 미리 만들어놓음. 요청 들어올때마다 스레드를 한 개씩 꺼내서 사용함. 단, 스레드를 다 사용하면 없애는게 아니라 반환하는거임. 

스레드 풀의 숫자를 조절하는 것이 WAS 성능 유닝에 직결되는 것임. 그런 것은 경험으로 알아가야함. 정확한 해는 찾을 수 없고 대충 추정치를 찾는 과정이 필요함. 성능 측정은 네이버에서 만든 nGrinder를 추천하신다고 함. 제이미터랑 아파치 ab는 넘 기초적인것만 제공함.

우리는 멀티 스레드 환경에 있고 스프링은 빈 객체를 싱글톤으로 만들기 때무에 공유 변수 사용을 조심해야함. WAS는 멀티 스레드 부분을 알아서 처리 하기 떄문에 개발자들은 싱글 스레드 프로그래밍 하듯이 편안하게 소스 코드를 개발하면 된다.

## HTML, HTTP API, CSR, SSR
백엔드 개발자는 3가지 경우를 생각해야함. 1. 그냥 정적인 리소스 내려주기 2. SSR 서버사이드 랜더링 3. CSR 클라이언트 사이드 랜더링

첫번째는 걍 파일 날려주면 됨.
두번째는 서버에서 html 파일을 동적으로 파싱한다음에 내려주면 됨 타임리프쓰면 됨. JSP는 망한듯 ㅋㅋ;
세번째는 키퍼 할 때 REST API 처럼 JSON 형태로 데이터 내려주면 프론트 쪽에서 어떻게 하는거임

이번 강의에서 타임리프를 사용하고 배울 것 같은데 배워두면 개인 프로젝트 할 때 도움이 많이 될 듯.

## 자바 백엔드 웹 기술 역사
