---
published: false
title:  "Spring Security - 웹 애플리케이션 이해"
categories:
  - spring
---

## 웹 서버, 웹 애플리케이션 서버

Web Server는 정적인 리소스(HTML, CSS, 이미지)를 제공할 수 있습니다. 가장 잘 알려져 있는 예시로는 NGINX, APACHE가 있습니다. 반면에 Web Application Server(WAS)는 정적인 리로스뿐만 아니라, 동적인 리소스를 제공할 수 있습니다. 대표적인 예시로 Tomcat이 있습니다.

정적인 리소스와 동적인 리소스 둘 다 제공할 수 있는 WAS만 사용하면 다음 그림과 같이 시스템을 구성할 수 있습니다.

![WAS1](https://github.com/02ggang9/02ggang9.github.io/blob/master/_posts/images/spring/mvc/Chapter1/WAS.png?raw=true "출처: 스프링 MVC 1편 - 백엔드 웹 개발 핵심 기술 -김영한-")

하지만 이런 방식은 큰 문제점이 있습니다. WAS가 정적, 동적, 어플리케이션 로직 등 너무 많은 역할을 하고 있기 때문에 서버가 다운될 우려가 있습니다. 또, 비용이 적게드는 정적인 리소스 때문에 비용이 많이 드는 어플리케이션 로직을 수행하는데 어려움을 겪을 수 있습니다. 이러한 문제는 WAS 앞단에 Web Server를 둬 해결할 수 있습니다.

![WAS2](https://github.com/02ggang9/02ggang9.github.io/blob/master/_posts/images/spring/mvc/Chapter1/WAS2.png?raw=true "출처: 스프링 MVC 1편 - 백엔드 웹 개발 핵심 기술 -김영한-")

이런 구조로 된다면 WAS의 역할이 줄어들고 어플리케이션 로직에만 집중할 수 있게 됩니다. 그리고 정적인 리소스를 많이 제공해야 한다면 Web Server만 증설하여 문제를 해결할 수 있고, 동적인 리소스를 많이 제공해야 한다면 WAS를 증설하여 문제를 해결할 수 있습니다.

## 서블릿

서블릿은 클라이언트의 요청 처리와 응답 반환을 쉽게 도와주는 자바 웹 프로그래밍 기술입니다. 서블릿이 없다면 http 메시지를 파싱하고 예외처리를 한 후 

서블릿은 클라이언트의 요청과 결과를 반활할 수 있도록 도와주는 기술임. 어떻게 도와주냐
우리가 폼 형식으로 데이터를 전송하면 개발자는 뭘 해야함? http 메시지를 슬라이스치고 데이터를 읽어와야함. 예를 들면 md -> pdf로 변환할 때 "###"가 몇 번 쓰였는지 확인해야 하는 것처럼 
근데 서블릿은 이걸 알아서 다 잘라줌. 개발자들이 해야 할것은 extends HttpServlet을 상속받아서 메서드를 구현하면 됨. 근데 메서드 구현할 때 파라미터로 두 개를 받는데 HttpSerlvetRequest고, HttpServletResponse임. 애네들을 사용해서 쉽게 메시지를 가져오고 쉽게 결과 값을 반환할 수 있음.

클라이언트에서 request가 들어오면 서블릿 객체를 새로 만듬. (정확히 말하면 새로 만드는게 아니라 재사용함. 얘네 둘은 서블릿 컨테이너가 뜰 때 싱글톤으로 만들어짐. 계속 재사용하는거임.) 서블릿 컨테이너가 내려가면 서블릿 객체는 사라짐. 생명주기도 관리해준다 ㅇㅇ;
근데 사용자 요청이 들어오면 reqeust랑 response를 새로 만들어줘야힘. 왜냐하면 내가 로그인 했는데 다른 사람 계정이 보이면 안됨.
공유변수 사용 조심해야 하고 얘네들은 동시 요청을 위한 멀티 스레드 처리도 지원한다고 함. 이건 다음 강의 때 배우자.


## 쓰레드
우리의 코드는 스레드가 실행시킴. 자바 코드를 작성할 때 main 스레드를 실행시켜 봤겠지요. main 쓰레드 하나만 동작하면 1초에 1000명~1만명이 들어오는 reqeust를 처리할 수 없음. 만약 main 스레드 하나만 동작하면 클라이언트 한명만 request를 보내고 response를 받을 수 있음. 이렇게 되면 안됨. 다른 클라이언트는 스레드를 기다려야 함. 근데 만약에 벌크 쿼리 잘못 날려서 스레드가 지연되면 그냥 WAS가 죽어버림.

두 번째 방법으로 요청마다 쓰레드를 생성해버리면 과부하로 WAS가 죽음. CPU, 메모리 임계점 넘어가버리면 WAS 죽음.

절충안으로 WAS는 스레드 풀에 여러개의 스레드를 미리 만들어놓음. 요청 들어올때마다 스레드를 한 개씩 꺼내서 사용함. 단, 스레드를 다 사용하면 없애는게 아니라 반환하는거임. 

스레드 풀의 숫자를 조절하는 것이 WAS 성능 유닝에 직결되는 것임. 그런 것은 경험으로 알아가야함. 정확한 해는 찾을 수 없고 대충 추정치를 찾는 과정이 필요함. 성능 측정은 네이버에서 만든 nGrinder를 추천하신다고 함. 제이미터랑 아파치 ab는 넘 기초적인것만 제공함.

우리는 멀티 스레드 환경에 있고 스프링은 빈 객체를 싱글톤으로 만들기 때무에 공유 변수 사용을 조심해야함. WAS는 멀티 스레드 부분을 알아서 처리 하기 떄문에 개발자들은 싱글 스레드 프로그래밍 하듯이 편안하게 소스 코드를 개발하면 된다.

## HTML, HTTP API, CSR, SSR
백엔드 개발자는 3가지 경우를 생각해야함. 1. 그냥 정적인 리소스 내려주기 2. SSR 서버사이드 랜더링 3. CSR 클라이언트 사이드 랜더링

첫번째는 걍 파일 날려주면 됨.
두번째는 서버에서 html 파일을 동적으로 파싱한다음에 내려주면 됨 타임리프쓰면 됨. JSP는 망한듯 ㅋㅋ;
세번째는 키퍼 할 때 REST API 처럼 JSON 형태로 데이터 내려주면 프론트 쪽에서 어떻게 하는거임

이번 강의에서 타임리프를 사용하고 배울 것 같은데 배워두면 개인 프로젝트 할 때 도움이 많이 될 듯.

